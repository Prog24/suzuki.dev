<!DOCTYPE html><html lang="en"><head><meta name="theme-color" content="#009688"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135441804-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-135441804-1', {
              page_path: window.location.pathname,
            });
          </script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><title>Google HomeでConoHaの料金確認 - Suzuki@Prog24</title><meta name="description" content="Google HomeでConoHaの料金確認"/><meta property="og:type" content="website"/><meta property="og:image" content="https://og-image-prog24.vercel.app/Google HomeでConoHaの料金確認.png"/><meta property="og:description" content="Google HomeでConoHaの料金確認"/><meta property="og:url" content="https://suzuki.dev/blog/GoogleHome-ConoHa"/><meta property="og:title" content="Google HomeでConoHaの料金確認"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@Prog24_jp"/><meta name="twitter:creator" content="@Prog24_jp"/><meta name="next-head-count" content="12"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-39cfd63b158336cc.js" defer=""></script><script src="/_next/static/chunks/framework-686549ad788ffa49.js" defer=""></script><script src="/_next/static/chunks/main-4bb9d41f60aff50a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-414507edfcda0cae.js" defer=""></script><script src="/_next/static/chunks/886-f15a0cc60ad69bc6.js" defer=""></script><script src="/_next/static/chunks/944-96970a72ede4d745.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-a937555c0047787d.js" defer=""></script><script src="/_next/static/C00xniqbgQeHEzEJHwYC7/_buildManifest.js" defer=""></script><script src="/_next/static/C00xniqbgQeHEzEJHwYC7/_ssgManifest.js" defer=""></script><script src="/_next/static/C00xniqbgQeHEzEJHwYC7/_middlewareManifest.js" defer=""></script><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 2a154x 188wmfm 1c0cfyw towylb 1ujbaps vubbuv 1jhfscy jabh6n 1e8l8z6 1ayd15j 1csq5n0 s40lgb ir8c5x 14ykmu scynry 4ki1pr gyb8ks bt1v0g qzmvvo nhb8h9 1486cn9 3mf706 fbskc8 1ynyhby p3aqws 1pjtbja 1c5ij41 egfpus 44k97o">.css-2a154x{background-color:#323336;}.css-188wmfm{background-color:#484954;width:100%;border-top:8px solid #009688;}@media (max-width:899.95px){.css-188wmfm{padding:16px;}}@media (min-width:900px){.css-188wmfm{padding:64px;padding-top:32px;}}.css-1c0cfyw{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1c0cfyw{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-1c0cfyw{max-width:900px;}}.css-towylb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;padding:8px;}.css-1ujbaps{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:#fff;-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#009688;padding:12px;font-size:1.75rem;}.css-1ujbaps::-moz-focus-inner{border-style:none;}.css-1ujbaps.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujbaps{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujbaps:hover{background-color:rgba(255, 255, 255, 0.08);}@media (hover: none){.css-1ujbaps:hover{background-color:transparent;}}.css-1ujbaps:hover{background-color:rgba(0, 150, 136, 0.08);}@media (hover: none){.css-1ujbaps:hover{background-color:transparent;}}.css-1ujbaps.Mui-disabled{background-color:transparent;color:rgba(255, 255, 255, 0.3);}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-1jhfscy{border-radius:50%;width:100px;height:100px;}.css-jabh6n{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;color:#FFF;margin-bottom:8px;}.css-1e8l8z6{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:rgba(256,256,256,0.6);}.css-1ayd15j{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;vertical-align:text-bottom;box-sizing:inherit;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1csq5n0{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;color:#1DA1F2;}.css-s40lgb{margin-right:8px;color:#FFF;}.css-ir8c5x{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;color:#171515;}.css-14ykmu{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;color:#41C9B4;}.css-scynry{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;color:#009688;}.css-4ki1pr{color:#FFF;-webkit-text-decoration:underline;text-decoration:underline;cursor:pointer;margin-right:8px;}.css-gyb8ks{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-gyb8ks{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-gyb8ks{max-width:900px;}}@media (max-width:899.95px){.css-gyb8ks{padding-top:16px;padding-bottom:16px;}}@media (min-width:900px){.css-gyb8ks{padding-top:32px;padding-bottom:32px;}}.css-bt1v0g{background-color:#484954;color:#FFF;-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-image:linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05));padding:16px;border-radius:8px;}.css-qzmvvo{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:rgba(256,256,256,0.6);}.css-nhb8h9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0;margin:0;list-style:none;}.css-1486cn9{color:rgba(256,256,256,0.6);-webkit-text-decoration:underline;text-decoration:underline;cursor:pointer;}.css-3mf706{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin-left:8px;margin-right:8px;}.css-fbskc8{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:#FFF;}.css-1ynyhby{margin:8px;}.css-p3aqws{font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:0.8125rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;height:24px;color:#FFF;background-color:rgba(255, 255, 255, 0.16);border-radius:16px;white-space:nowrap;-webkit-transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;cursor:default;outline:0;-webkit-text-decoration:none;text-decoration:none;border:0;padding:0;vertical-align:middle;box-sizing:border-box;margin:4px;}.css-p3aqws.Mui-disabled{opacity:0.38;pointer-events:none;}.css-p3aqws .MuiChip-avatar{margin-left:5px;margin-right:-6px;width:24px;height:24px;color:#e0e0e0;font-size:0.75rem;}.css-p3aqws .MuiChip-avatarColorPrimary{color:#fff;background-color:rgb(0, 105, 95);}.css-p3aqws .MuiChip-avatarColorSecondary{color:rgba(0, 0, 0, 0.87);background-color:#ab47bc;}.css-p3aqws .MuiChip-avatarSmall{margin-left:4px;margin-right:-4px;width:18px;height:18px;font-size:0.625rem;}.css-p3aqws .MuiChip-icon{color:#e0e0e0;margin-left:4px;margin-right:-4px;font-size:18px;}.css-p3aqws .MuiChip-deleteIcon{-webkit-tap-highlight-color:transparent;color:rgba(255, 255, 255, 0.26);font-size:16px;cursor:pointer;margin:0 5px 0 -6px;margin-right:4px;margin-left:-4px;}.css-p3aqws .MuiChip-deleteIcon:hover{color:rgba(255, 255, 255, 0.4);}.css-1pjtbja{overflow:hidden;text-overflow:ellipsis;padding-left:8px;padding-right:8px;white-space:nowrap;}.css-1c5ij41{margin:16px;}.css-egfpus{color:#009688;-webkit-text-decoration:underline;text-decoration:underline;cursor:pointer;}.css-44k97o{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.75;letter-spacing:0.00938em;color:#FFF;}</style><style data-href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxM.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="css-2a154x"><div class="css-188wmfm"><div class="MuiContainer-root MuiContainer-maxWidthMd css-1c0cfyw"><div class="MuiBox-root css-towylb"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorPrimary MuiIconButton-sizeLarge css-1ujbaps" tabindex="0" type="button" aria-label="Light Mode"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LightModeOutlinedIcon" aria-label="Light Mode"><path d="M12 9c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3m0-2c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"></path></svg></button></div><div style="display:flex"><div style="min-width:100px"><img src="/icon.png" alt="Icon" class="css-1jhfscy"/></div><div style="margin-left:24px"><h5 class="MuiTypography-root MuiTypography-h5 css-jabh6n">Suzuki@Prog24</h5><p class="MuiTypography-root MuiTypography-body1 css-1e8l8z6">Webエンジニア<br/>最近はWeb系の開発をしている．</p></div></div><div style="margin-top:16px"><p class="css-1ayd15j"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1csq5n0" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg><a href="https://twitter.com/Prog24_jp" target="_blank" rel="noreferrer" class="css-s40lgb"> Prog24_jp</a></p><p class="css-1ayd15j"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-ir8c5x" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg><a href="https://github.com/Prog24" target="_blank" rel="noreferrer" class="css-s40lgb"> Prog24</a></p><p class="css-1ayd15j"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-14ykmu" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M6.79665 6.77627V5.24663C6.79665 4.96788 6.81108 4.87492 6.854 4.73191C6.9687 4.33881 7.35596 4.04579 7.81475 4.04579C8.27354 4.04579 8.66067 4.34594 8.77537 4.73191C8.81841 4.87492 8.83285 4.96788 8.83285 5.24663V7.60539C8.83285 7.7484 8.83285 7.89127 8.80411 8.02002C8.7253 8.37734 8.40267 8.69913 8.04414 8.7777C7.91514 8.80623 7.7717 8.80623 7.62827 8.80623H5.26241C4.98282 8.80623 4.88958 8.79197 4.74615 8.74905C4.35901 8.6347 4.05796 8.24873 4.05796 7.79131C4.05796 7.33377 4.35901 6.9478 4.74615 6.83344C4.88958 6.79053 4.98282 6.77627 5.26241 6.77627H6.79665ZM15.2279 17.4697H2.53803V6.32598C2.53803 6.18298 2.58823 6.06149 2.68862 5.9614L5.97933 2.68043C6.07973 2.58047 6.20158 2.53042 6.34501 2.53042H15.2279V17.4697ZM16.6691 0.0142621C16.6045 0.00713093 16.5185 0 16.3536 0H6.00794C5.89338 0 5.77868 0.00713093 5.69974 0.0142621C5.22652 0.0571765 4.8035 0.278753 4.46656 0.614682L0.616531 4.45316C0.279719 4.78922 0.0573491 5.21085 0.0144334 5.68265C0.00715303 5.76122 0 5.87557 0 5.98993V18.5918C0 18.7562 0.00715303 18.8421 0.0144334 18.9064C0.0716543 19.4425 0.559182 19.9284 1.09691 19.9856C1.16153 19.9929 1.24749 20 1.41239 20H16.3536C16.5185 20 16.6045 19.9929 16.6691 19.9856C17.2068 19.9284 17.6943 19.4425 17.7517 18.9064C17.7587 18.8421 17.766 18.7562 17.766 18.5918V1.40815C17.766 1.24375 17.7587 1.15792 17.7517 1.09362C17.6943 0.557505 17.2068 0.0714388 16.6691 0.0142621Z"></path></svg><a href="https://note.com/Prog24" target="_blank" rel="noreferrer" class="css-s40lgb"> Prog24</a></p><p class="css-1ayd15j"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1csq5n0" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M0.883714 18.8675H4.73422C4.93807 18.8675 5.11927 18.7542 5.23252 18.5957L15.8328 1.17781C15.9687 0.951305 15.8101 0.679504 15.5383 0.679504H11.8916C11.7104 0.679504 11.5519 0.770105 11.4613 0.928655L0.702514 18.5504C0.634564 18.6863 0.725164 18.8675 0.883714 18.8675Z"></path><path d="M14.1571 18.5957L19.1628 10.555C19.3213 10.3058 19.1401 9.98871 18.8457 9.98871H15.2216C15.0857 9.98871 14.9498 10.0567 14.8819 10.1699L9.74034 18.3919C9.60444 18.5957 9.76299 18.8675 10.0121 18.8675H13.7041C13.8853 18.8675 14.0665 18.7769 14.1571 18.5957Z"></path></svg><a href="https://zenn.dev/prog24" target="_blank" rel="noreferrer" class="css-s40lgb"> prog24</a></p><p class="css-1ayd15j"><svg class="MuiSvgIcon-root MuiSvgIcon-colorPrimary MuiSvgIcon-fontSizeMedium css-scynry" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="RssFeedIcon"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg><a class="css-4ki1pr">Blog</a></p></div></div></div><div class="MuiContainer-root MuiContainer-maxWidthMd css-gyb8ks"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 css-bt1v0g"><nav class="MuiTypography-root MuiTypography-body1 MuiBreadcrumbs-root css-qzmvvo" aria-label="breadcrumb"><ol class="MuiBreadcrumbs-ol css-nhb8h9"><li class="MuiBreadcrumbs-li"><a class="css-1486cn9">HOME</a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator css-3mf706">/</li><li class="MuiBreadcrumbs-li"><a class="css-1486cn9">blog</a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator css-3mf706">/</li><li class="MuiBreadcrumbs-li"><p class="MuiTypography-root MuiTypography-body1 css-fbskc8">Google HomeでConoHaの料金確認<!-- --> - posted <!-- -->2017.12.1</p></li></ol></nav><div class="MuiBox-root css-1ynyhby"></div><div class="MuiChip-root MuiChip-filled MuiChip-sizeSmall MuiChip-colorDefault MuiChip-filledDefault css-p3aqws"><span class="MuiChip-label MuiChip-labelSmall css-1pjtbja">アドベントカレンダー</span></div><div class="MuiChip-root MuiChip-filled MuiChip-sizeSmall MuiChip-colorDefault MuiChip-filledDefault css-p3aqws"><span class="MuiChip-label MuiChip-labelSmall css-1pjtbja">API</span></div><div class="MuiChip-root MuiChip-filled MuiChip-sizeSmall MuiChip-colorDefault MuiChip-filledDefault css-p3aqws"><span class="MuiChip-label MuiChip-labelSmall css-1pjtbja">ConoHa</span></div><div class="MuiChip-root MuiChip-filled MuiChip-sizeSmall MuiChip-colorDefault MuiChip-filledDefault css-p3aqws"><span class="MuiChip-label MuiChip-labelSmall css-1pjtbja">PHP</span></div><div class="MuiBox-root css-1c5ij41"></div><p>これは<a href="https://qiita.com/advent-calendar/2017/conoha" node="[object Object]" class="css-egfpus">ConoHa Advent Calendar 2017</a> 18日目の記事です。</p>
<h2>今回作ったもの</h2>
<p>Google Homeでこのはちゃんへの貢ぎ度サーバ代金を確認するアプリです。<br/>
<!-- -->Google Homeに「料金教えて」と聞くとConoHaのサーバ料金を教えてくれるというものです。<br/>
<!-- -->今回は取り敢えずで作ったものなので完全個人向けで1つのアカウントのみに対応します。</p>
<h2>作り方（手順）</h2>
<ul>
<li>ConoHaのAPIを叩いて今月のサーバ代金をjson形式で返すプログラムの作成</li>
<li>作成したプログラムを適当なサーバに転がす</li>
<li>Action on Googleとdialogflowの設定</li>
</ul>
<h2>ConoHaのAPIを叩いて今月のサーバ代金をjson形式で返すプログラムの作成</h2>
<p>ConoHaのAPIを叩く処理は<a href="/posts/ConoHa%E3%81%AEAPI%E3%81%AB%E8%A7%A6%E3%82%8C%E3%81%A6%E3%81%BF%E3%81%9F" node="[object Object]" class="css-egfpus">1週間ほど前に行った</a>ので同じ感じに行った。</p>
<p>しかし、今回はjsonで返さないといけないので少しだけ修正。<br/>
<!-- -->修正後のコードはこんな感じになりました。ConoHaのAPI用のユーザ名などの情報は直書きしてしまっています。。多分よくないよね。。</p>
<p><strong>※{“speach”, “話させる内容”} こういう形で返さないといけないということを知らなくて結構時間かけてしまいました。</strong></p>
<pre><div style="color:#f8f8f2;background:#2b2b2b;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-php" style="color:#f8f8f2;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token php language-php delimiter" style="color:#ffd700;font-weight:bold">&lt;?php</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$username</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;ユーザ名&quot;</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$password</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;パスワード&quot;</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$tenantId</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;テナントID&quot;</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition" style="color:#ffd700">getToken</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$username</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$password</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$tenantId</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">{</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#00e0e0">$url</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;https://identity.tyo1.conoha.io/v2.0/tokens&quot;</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#00e0e0">$headers</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">array</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php">
</span><span class="token php language-php">		</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;Accept: application/json&quot;</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#00e0e0">$req_data</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">array</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php">
</span><span class="token php language-php">		</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;auth&quot;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">array</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php">
</span><span class="token php language-php">			</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;passwordCredentials&quot;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">array</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php">
</span><span class="token php language-php">				</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;username&quot;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$username</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php">
</span><span class="token php language-php">				</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;password&quot;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$password</span><span class="token php language-php">
</span><span class="token php language-php">			</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php">
</span><span class="token php language-php">			</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;tenantId&quot;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$tenantId</span><span class="token php language-php">
</span><span class="token php language-php">		</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">curl_init</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_URL</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$url</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_RETURNTRANSFER</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">true</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_HTTPHEADER</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$headers</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_POST</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">true</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_POSTFIELDS</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">json_encode</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$req_data</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_SSL_VERIFYPEER</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">false</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">$res_json</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php">  </span><span class="token php language-php" style="color:#ffd700">curl_exec</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">$res_data</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">json_decode</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$res_json</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_close</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$ch</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">return</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$res_data</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">}</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition" style="color:#ffd700">getPayList</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$token</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$tenantId</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">{</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">$url</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;https://account.tyo1.conoha.io/v1/</span><span class="token php language-php double-quoted-string interpolation" style="color:#abe338">{</span><span class="token php language-php double-quoted-string interpolation" style="color:#abe338">$tenantId</span><span class="token php language-php double-quoted-string interpolation" style="color:#abe338">}</span><span class="token php language-php double-quoted-string" style="color:#abe338">/billing-invoices?limit=3&quot;</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">$headers</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">array</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php">
</span><span class="token php language-php">        </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;Accept: application/json&quot;</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php">
</span><span class="token php language-php">        </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;X-Auth-Token: </span><span class="token php language-php double-quoted-string interpolation" style="color:#abe338">{</span><span class="token php language-php double-quoted-string interpolation" style="color:#abe338">$token</span><span class="token php language-php double-quoted-string interpolation" style="color:#abe338">}</span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">curl_init</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_URL</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$url</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_CUSTOMREQUEST</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php single-quoted-string" style="color:#abe338">&#x27;GET&#x27;</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_HTTPHEADER</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$headers</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_SSL_VERIFYPEER</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">false</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#ffd700">curl_setopt</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffa07a">CURLOPT_RETURNTRANSFER</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">true</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">$response</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">curl_exec</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$curl</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php">    </span><span class="token php language-php" style="color:#00e0e0">return</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$response</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">}</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition" style="color:#ffd700">makeJson</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$data</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">{</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php" style="color:#00e0e0">return</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">json_encode</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$data</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">}</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$tokens</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">getToken</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$username</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$password</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$tenantId</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$token</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$tokens</span><span class="token php language-php" style="color:#00e0e0">-&gt;</span><span class="token php language-php" style="color:#ffa07a">access</span><span class="token php language-php" style="color:#00e0e0">-&gt;</span><span class="token php language-php" style="color:#ffa07a">token</span><span class="token php language-php" style="color:#00e0e0">-&gt;</span><span class="token php language-php" style="color:#ffa07a">id</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$data</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">getPayList</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$token</span><span class="token php language-php" style="color:#fefefe">,</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$tenantId</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$array</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">json_decode</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$data</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$pay</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$array</span><span class="token php language-php" style="color:#00e0e0">-&gt;</span><span class="token php language-php" style="color:#ffa07a">billing_invoices</span><span class="token php language-php" style="color:#fefefe">[</span><span class="token php language-php" style="color:#00e0e0">0</span><span class="token php language-php" style="color:#fefefe">]</span><span class="token php language-php" style="color:#00e0e0">-&gt;</span><span class="token php language-php" style="color:#ffa07a">bill_plus_tax</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">$say_content</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">array</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php">
</span><span class="token php language-php">	</span><span class="token php language-php single-quoted-string" style="color:#abe338">&#x27;speech&#x27;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">$pay</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#00e0e0">.</span><span class="token php language-php"> </span><span class="token php language-php double-quoted-string" style="color:#abe338">&quot;円です&quot;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span><span class="token php language-php">
</span><span class="token php language-php"></span><span class="token php language-php" style="color:#00e0e0">echo</span><span class="token php language-php"> </span><span class="token php language-php" style="color:#ffd700">makeJson</span><span class="token php language-php" style="color:#fefefe">(</span><span class="token php language-php" style="color:#00e0e0">$say_content</span><span class="token php language-php" style="color:#fefefe">)</span><span class="token php language-php" style="color:#fefefe">;</span></code></div></pre>
<p>上記のコードを叩くとConoHaの料金を<br/>
<!-- -->{“speech”:”○○円です”} という形で返してくれるというものになります。<br/>
<!-- -->コードにユーザIDなどを直書きしているので他人に叩かれたら色々バレるので気をつけましょう。</p>
<h2>作成したプログラムを適当なサーバに転がす</h2>
<p>今回は先ほど作成したプログラムを叩いて返ってきた内容をそのまま話させるというものなのでどこかサーバに置かなきゃなぁ。。となりました。<br/>
<!-- -->まあ、このはちゃんに置いたらいいのかなとも思いましたが、このためにこのはちゃんに貢ぐのもアレなので別で契約しているサーバに起きました。</p>
<h2>Action on Googleとdialogflowの設定</h2>
<p>次に、先ほど作成したプログラムをGoogle Homeで叩けるようにする。</p>
<p>最初に<a href="https://console.actions.google.com/" node="[object Object]" class="css-egfpus">Action on Googleのコンソール画面</a>に行く。
<img src="/media/GoogleHome-ConoHa/conoha-advent1.png" alt="1" node="[object Object]" style="width:100%"/></p>
<p>「Add/import Project」をクリックしてプロジェクトの追加を行う。<br/>
<!-- -->今回はProject nameをConoHa、言語を日本語に設定した。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent2.png" alt="2" node="[object Object]" style="width:100%"/></p>
<p>プロジェクトを作成したらいくつか選択肢が出てくるので今回は「Dialogflow」を選択してアプリを作っていきます。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent3.png" alt="3" node="[object Object]" style="width:100%"/></p>
<p>Dialogflowのページに行ったらアプリ名をConoHa（おそらくデフォルトで設定されているはず）、言語を日本語に設定してCREATEボタンを押します。<br/>
<!-- -->この時、デフォルトの言語は日本語ではなくなっているので変更を忘れないように注意しないといけません。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent4.png" alt="4" node="[object Object]" style="width:100%"/></p>
<p>次に、左メニューの「Fulfillment」をクリックし、webhookの設定を書きます。<br/>
<!-- -->最初に作成したプログラムを置いたURLを指定します。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent6.png" alt="5" node="[object Object]" style="width:100%"/></p>
<p>次に左メニューの「Intents」に行き、ユーザの言葉に対する動作を設定します。<br/>
<!-- -->今回は「料金教えて」と話されたら、先ほど設定したwebhookで返って来たデータを喋らせる。という動作をさせたいので画像のように設定しました。<br/>
<!-- -->※Fulfillmentの項目でUse webhookを選択したらResponseに何を書いてもwebhookの返答しか返ってこないようでした。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent7.png" alt="6" node="[object Object]" style="width:100%"/></p>
<p>最後に左メニューのIntegrationsでGoogle Assistantと連携させたらDialogflowの設定は完了です。</p>
<p>IntegrationsのページでGoogle Assistantを選択し、UPDATE DRAFTを押します。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent8.png" alt="7" node="[object Object]" style="width:100%"/></p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent9.png" alt="8" node="[object Object]" style="width:100%"/></p>
<h2>完成</h2>
<p>これで一応完成です。<br/>
<!-- -->Actions on Googleのコンソールページに戻り、シミュレータで動作確認をします。<br/>
<!-- -->現状、アプリの呼び出し設定ができていないので「テスト用アプリにつないで」という呼び出し方しかできません。<br/>
<!-- -->設定しようとしたのですが、項目が多くてよく分からなかったです。また後でやります。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent12.png" alt="9" node="[object Object]" style="width:100%"/></p>
<p>そして、こんな感じに「料金教えて」と言えば前回支払いのサーバ代金を答えてくれます。<br/>
<!-- -->Google Homeにアカウントを紐付ければ同じように使用することが出来ました。</p>
<p><img src="/media/GoogleHome-ConoHa/conoha-advent13.png" alt="10" node="[object Object]" style="width:100%"/></p>
<p>「1円です」。。。ここ最近ConoHaでサーバを立てていませんでした。。。</p>
<h2>まとめ</h2>
<p>今回は「前回までの支払い情報を取得する」APIを使用して一応動作したので、別のAPIも使用してGoogle Home経由でこのはちゃんに色々してもらえるようにしていこうと思います。</p><h6 class="MuiTypography-root MuiTypography-subtitle1 css-44k97o">SNSでシェア</h6><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="36" height="36"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="facebook" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="36" height="36"><circle cx="32" cy="32" r="31" fill="#3b5998"></circle><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></svg></button><button aria-label="hatena" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="36" height="36"><circle cx="32" cy="32" r="31" fill="#009ad9"></circle><path d="M 36.164062 33.554688 C 34.988281 32.234375 33.347656 31.5 31.253906 31.34375 C 33.125 30.835938 34.476562 30.09375 35.335938 29.09375 C 36.191406 28.09375 36.609375 26.78125 36.609375 25.101562 C 36.628906 23.875 36.332031 22.660156 35.75 21.578125 C 35.160156 20.558594 34.292969 19.71875 33.253906 19.160156 C 32.304688 18.640625 31.175781 18.265625 29.847656 18.042969 C 28.523438 17.824219 26.195312 17.730469 22.867188 17.730469 L 14.769531 17.730469 L 14.769531 47.269531 L 23.113281 47.269531 C 26.46875 47.269531 28.886719 47.15625 30.367188 46.929688 C 31.851562 46.695312 33.085938 46.304688 34.085938 45.773438 C 35.289062 45.148438 36.28125 44.179688 36.933594 42.992188 C 37.597656 41.796875 37.933594 40.402344 37.933594 38.816406 C 37.933594 36.621094 37.347656 34.867188 36.164062 33.554688 Z M 22.257812 24.269531 L 23.984375 24.269531 C 25.988281 24.269531 27.332031 24.496094 28.015625 24.945312 C 28.703125 25.402344 29.042969 26.183594 29.042969 27.285156 C 29.042969 28.390625 28.664062 29.105469 27.9375 29.550781 C 27.210938 29.992188 25.84375 30.199219 23.855469 30.199219 L 22.257812 30.199219 Z M 29.121094 41.210938 C 28.328125 41.691406 26.976562 41.925781 25.078125 41.925781 L 22.257812 41.925781 L 22.257812 35.488281 L 25.195312 35.488281 C 27.144531 35.488281 28.496094 35.738281 29.210938 36.230469 C 29.925781 36.726562 30.304688 37.582031 30.304688 38.832031 C 30.304688 40.078125 29.914062 40.742188 29.105469 41.222656 Z M 29.121094 41.210938 M 46.488281 39.792969 C 44.421875 39.792969 42.742188 41.46875 42.742188 43.535156 C 42.742188 45.605469 44.421875 47.28125 46.488281 47.28125 C 48.554688 47.28125 50.230469 45.605469 50.230469 43.535156 C 50.230469 41.46875 48.554688 39.792969 46.488281 39.792969 Z M 46.488281 39.792969 M 43.238281 17.730469 L 49.738281 17.730469 L 49.738281 37.429688 L 43.238281 37.429688 Z M 43.238281 17.730469 " fill="white"></path></svg></button><button aria-label="pocket" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="36" height="36"><circle cx="32" cy="32" r="31" fill="#EF3F56"></circle><path d="M41.084 29.065l-7.528 7.882a2.104 2.104 0 0 1-1.521.666 2.106 2.106 0 0 1-1.522-.666l-7.528-7.882c-.876-.914-.902-2.43-.065-3.384.84-.955 2.228-.987 3.1-.072l6.015 6.286 6.022-6.286c.88-.918 2.263-.883 3.102.071.841.938.82 2.465-.06 3.383l-.015.002zm6.777-10.976C47.463 16.84 46.361 16 45.14 16H18.905c-1.2 0-2.289.82-2.716 2.044-.125.363-.189.743-.189 1.125v10.539l.112 2.096c.464 4.766 2.73 8.933 6.243 11.838.06.053.125.102.19.153l.04.033c1.882 1.499 3.986 2.514 6.259 3.014a14.662 14.662 0 0 0 6.13.052c.118-.042.235-.065.353-.087.03 0 .065-.022.098-.042a15.395 15.395 0 0 0 6.011-2.945l.039-.045.18-.153c3.502-2.902 5.765-7.072 6.248-11.852L48 29.674v-10.52c0-.366-.041-.728-.161-1.08l.022.015z" fill="white"></path></svg></button></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Google HomeでConoHaの料金確認","date":"2017-12-18T10:00:00.000Z","template":"post","draft":false,"slug":"GoogleHome-ConoHa","category":"アドベントカレンダー","tags":["API","ConoHa","PHP"],"description":"Google HomeでConoHaの料金確認"},"markdownBody":"\nこれは[ConoHa Advent Calendar 2017](https://qiita.com/advent-calendar/2017/conoha) 18日目の記事です。\n## 今回作ったもの\nGoogle Homeでこのはちゃんへの貢ぎ度サーバ代金を確認するアプリです。  \nGoogle Homeに「料金教えて」と聞くとConoHaのサーバ料金を教えてくれるというものです。  \n今回は取り敢えずで作ったものなので完全個人向けで1つのアカウントのみに対応します。\n\n## 作り方（手順）\n- ConoHaのAPIを叩いて今月のサーバ代金をjson形式で返すプログラムの作成\n- 作成したプログラムを適当なサーバに転がす\n- Action on Googleとdialogflowの設定\n\n## ConoHaのAPIを叩いて今月のサーバ代金をjson形式で返すプログラムの作成\nConoHaのAPIを叩く処理は[1週間ほど前に行った](/posts/ConoHaのAPIに触れてみた)ので同じ感じに行った。  \n\nしかし、今回はjsonで返さないといけないので少しだけ修正。  \n修正後のコードはこんな感じになりました。ConoHaのAPI用のユーザ名などの情報は直書きしてしまっています。。多分よくないよね。。\n\n**※{“speach”, “話させる内容”} こういう形で返さないといけないということを知らなくて結構時間かけてしまいました。**\n\n```php\n\u003c?php\n$username = \"ユーザ名\";\n$password = \"パスワード\";\n$tenantId = \"テナントID\";\nfunction getToken($username, $password, $tenantId)\n{\n\t$url = \"https://identity.tyo1.conoha.io/v2.0/tokens\";\n\t$headers = array(\n\t\t\"Accept: application/json\"\n\t);\n\t$req_data = array(\n\t\t\"auth\" =\u003e array(\n\t\t\t\"passwordCredentials\" =\u003e array(\n\t\t\t\t\"username\" =\u003e $username,\n\t\t\t\t\"password\" =\u003e $password\n\t\t\t),\n\t\t\t\"tenantId\" =\u003e $tenantId\n\t\t)\n\t);\n\t$ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, $url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($req_data));\n    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);\n    $res_json =  curl_exec($ch);\n    $res_data = json_decode($res_json);\n    curl_close($ch);\n    return $res_data;\n}\nfunction getPayList($token, $tenantId)\n{\n    $url = \"https://account.tyo1.conoha.io/v1/{$tenantId}/billing-invoices?limit=3\";\n    $headers = array(\n        \"Accept: application/json\",\n        \"X-Auth-Token: {$token}\"\n    );\n    $curl = curl_init();\n    curl_setopt($curl, CURLOPT_URL, $url);\n    curl_setopt($curl, CURLOPT_CUSTOMREQUEST, 'GET');\n    curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);\n    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);\n    curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\n    $response = curl_exec($curl);\n    return $response;\n}\nfunction makeJson($data)\n{\n\treturn json_encode($data);\n}\n$tokens = getToken($username, $password, $tenantId);\n$token = $tokens-\u003eaccess-\u003etoken-\u003eid;\n$data = getPayList($token, $tenantId);\n$array = json_decode($data);\n$pay = $array-\u003ebilling_invoices[0]-\u003ebill_plus_tax;\n$say_content = array(\n\t'speech' =\u003e $pay . \"円です\"\n);\necho makeJson($say_content);\n```\n\n上記のコードを叩くとConoHaの料金を  \n{“speech”:”○○円です”} という形で返してくれるというものになります。  \nコードにユーザIDなどを直書きしているので他人に叩かれたら色々バレるので気をつけましょう。\n\n## 作成したプログラムを適当なサーバに転がす\n今回は先ほど作成したプログラムを叩いて返ってきた内容をそのまま話させるというものなのでどこかサーバに置かなきゃなぁ。。となりました。  \nまあ、このはちゃんに置いたらいいのかなとも思いましたが、このためにこのはちゃんに貢ぐのもアレなので別で契約しているサーバに起きました。\n\n## Action on Googleとdialogflowの設定\n次に、先ほど作成したプログラムをGoogle Homeで叩けるようにする。  \n\n最初に[Action on Googleのコンソール画面](https://console.actions.google.com/)に行く。\n![1](/media/GoogleHome-ConoHa/conoha-advent1.png)\n\n「Add/import Project」をクリックしてプロジェクトの追加を行う。  \n今回はProject nameをConoHa、言語を日本語に設定した。\n\n![2](/media/GoogleHome-ConoHa/conoha-advent2.png)\n\nプロジェクトを作成したらいくつか選択肢が出てくるので今回は「Dialogflow」を選択してアプリを作っていきます。\n\n![3](/media/GoogleHome-ConoHa/conoha-advent3.png)\n\nDialogflowのページに行ったらアプリ名をConoHa（おそらくデフォルトで設定されているはず）、言語を日本語に設定してCREATEボタンを押します。  \nこの時、デフォルトの言語は日本語ではなくなっているので変更を忘れないように注意しないといけません。\n\n![4](/media/GoogleHome-ConoHa/conoha-advent4.png)\n\n次に、左メニューの「Fulfillment」をクリックし、webhookの設定を書きます。  \n最初に作成したプログラムを置いたURLを指定します。\n\n![5](/media/GoogleHome-ConoHa/conoha-advent6.png)\n\n次に左メニューの「Intents」に行き、ユーザの言葉に対する動作を設定します。  \n今回は「料金教えて」と話されたら、先ほど設定したwebhookで返って来たデータを喋らせる。という動作をさせたいので画像のように設定しました。  \n※Fulfillmentの項目でUse webhookを選択したらResponseに何を書いてもwebhookの返答しか返ってこないようでした。\n\n![6](/media/GoogleHome-ConoHa/conoha-advent7.png)\n\n最後に左メニューのIntegrationsでGoogle Assistantと連携させたらDialogflowの設定は完了です。  \n\nIntegrationsのページでGoogle Assistantを選択し、UPDATE DRAFTを押します。\n\n![7](/media/GoogleHome-ConoHa/conoha-advent8.png)\n\n![8](/media/GoogleHome-ConoHa/conoha-advent9.png)\n\n## 完成\nこれで一応完成です。  \nActions on Googleのコンソールページに戻り、シミュレータで動作確認をします。  \n現状、アプリの呼び出し設定ができていないので「テスト用アプリにつないで」という呼び出し方しかできません。  \n設定しようとしたのですが、項目が多くてよく分からなかったです。また後でやります。\n\n![9](/media/GoogleHome-ConoHa/conoha-advent12.png)\n\nそして、こんな感じに「料金教えて」と言えば前回支払いのサーバ代金を答えてくれます。  \nGoogle Homeにアカウントを紐付ければ同じように使用することが出来ました。\n\n![10](/media/GoogleHome-ConoHa/conoha-advent13.png)\n\n「1円です」。。。ここ最近ConoHaでサーバを立てていませんでした。。。\n\n## まとめ\n今回は「前回までの支払い情報を取得する」APIを使用して一応動作したので、別のAPIも使用してGoogle Home経由でこのはちゃんに色々してもらえるようにしていこうと思います。\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"GoogleHome-ConoHa"},"buildId":"C00xniqbgQeHEzEJHwYC7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>